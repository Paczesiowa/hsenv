if [ -n "${VIRTHUALENV}" ]; then
    echo "Virtual Haskell Environment is already activated (${VIRTHUALENV})."
else
    export VIRTHUALENV=<VIRTHUALENV>
    export GHC_PACKAGE_PATH=<GHC_PACKAGE_PATH>

    for path in PATH; do
        eval echo "export ${path}=\${${path}}"
    done > ${VIRTHUALENV}/.virthualenv/env_backup

    function deactivate {
        source ${VIRTHUALENV}/.virthualenv/env_backup
        rm ${VIRTHUALENV}/.virthualenv/env_backup
        unset -v VIRTHUALENV
        unset -v GHC_PACKAGE_PATH
        unset -f deactivate
    }

    export PATH=${VIRTHUALENV}/.virthualenv/bin:${VIRTHUALENV}/.cabal/bin:${PATH}
fi
